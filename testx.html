<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8">
    <title>è£ã®ãŠçµµã‹ããƒãƒ£ãƒ¬ãƒ³ã‚¸</title>
    <meta name="description" content="ã“ã®ã‚µã‚¤ãƒˆã¯çµµã‚’ã‹ã„ã¦æ¥½ã—ã‚€ã‚µã‚¤ãƒˆã§ã™">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="icon" href="ico.ico">
    <link rel="stylesheet" type="text/css" href="st1.css">
    <style>
      dt{
        font-size: 18px;
        margin-left: 5%;
        font-weight: bold;
      }
      dd{
        margin-left: 10%;
      }
    </style>
  </head>
  <body>
    <!-- ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã®ã‚¨ãƒªã‚¢ -->
     <div id="wrap">
      <header>
        <h1>è£ã®ãŠçµµã‹ããƒãƒ£ãƒ¬ãƒ³ã‚¸ğŸ‘»</h1>
      </header>
      <main>
          <p>ã“ã®ã‚µã‚¤ãƒˆã¯è¦æœ›ã«ã“ãŸãˆã¦éšæ™‚ä¿®æ­£ã—ã¦ã„ã¾ã™ã€‚ã€‚</p>
        <section>
          <h3>æ›´æ–°å±¥æ­´</h3>
          <dl>
            <dt>æç”»ãƒ¢ãƒ¼ãƒ‰ã‚’è¿½åŠ ã—ãŸã‚ˆãƒ¼!</dt>
            <dd>â—ã€â– ã€â–²ã€â¤ã¯ã‚¹ã‚¿ãƒ³ãƒ—ã¿ãŸã„ã«æŠ¼ã™ã“ã¨ãŒã§ãã‚‹ã‚ˆã€‚</dd>
          </dl>
        </section>
        <section>
          <h2>ãƒ«ãƒ¼ãƒ«</h2>
            <ol>
              <li>ã€ãƒ†ãƒ¼ãƒã‚’é¸ã¶ã€ãƒœã‚¿ãƒ³ã‚’æŠ¼ã—ã¦ãƒ†ãƒ¼ãƒã‚’æ±ºã‚ã‚‹ã€‚</li>
              <li>ãƒ†ãƒ¼ãƒã«ã‚ã£ãŸãŠçµµæãã«ãƒãƒ£ãƒ¬ãƒ³ã‚¸!</li>
              <li>ã§ãã‚ãŒã£ãŸçµµã¯ä¿å­˜ã—ã¦ã€ã¿ã‚“ãªã«å…±æœ‰ã—ã¦ã¿ã‚ˆã†!</li>
            </ol>
          <section>
            <h3>ã¯ã˜ã‚ã«</h3>
            <p>â‡©ä¸‹ã®ãƒœã‚¿ãƒ³ã‚’æŠ¼ã—ã¦ãƒ†ãƒ¼ãƒã‚’é¸ã‚“ã§ã­ã€‚(ãƒ†ãƒ¼ãƒã‚’å¤‰æ›´ã™ã‚‹ã¨çµµã¯ãƒªã‚»ãƒƒãƒˆã•ã‚Œã¾ã™)</p>
            <p><button onclick="select();" class="btn">ãƒ†ãƒ¼ãƒã‚’é¸ã¶</button></p>
          </section>
          <section>
            <div id = "canvases">
              <canvas id="canvas2"></canvas>
              <canvas id="canvas3"></canvas>
              <canvas id="canvas1"></canvas>
            </div>
            <p>ç·šã®å¤ªã•:ãƒ»<input type="range" id="input1" onchange="change1();" value="10" min="1" max="100">â—</p>
            <p>ç·šã®è‰²:<input type="color" id="input2" onchange="change2();" value="#0000ff"/>
            <p>æç”»ãƒ¢ãƒ¼ãƒ‰:
              <select id="mode" onchange="modeChange()">
                <option value="1">ãƒšãƒ³</option>
                <option value="2">â—</option>
                <option value="3">â– </option>
                <option value="4">â–²</option>
                <option value="5">â¤</option>
              </select>
            </p>

            <p>
              <button onclick="reload();">å…¨éƒ¨æ¶ˆã™</button>
              <button onclick="back();">ä¸€ã¤ã‚‚ã©ã‚‹</button>
            </p>
            <p id="ok"></p>
            <p id="save"></p>             
          </section>
        </section>
        <section>
          <h3>Q & A</h3>
          <dl>
            <dt>æ¶ˆã—ã‚´ãƒ ãŒãªã„</dt>
            <dd>ã€Œä¸€ã¤ã‚‚ã©ã‚‹ã€ã§æ“ä½œã‚’ä¸€ã¤æˆ»ã™æ©Ÿèƒ½ã—ã‹ãªã„ã§ã™ã€‚ã‚ã¨ã¯ãƒšãƒ³ã‚’ç™½ã«ã—ã¦ã†ã¾ã„ã“ã¨ãŒã‚“ã°ãƒ¼ğŸ‘»</dd>
            <dt>ç´°ã‹ã„ã¨ã“ã‚ãŒæãã¥ã‚‰ã„</dt>
            <dd>ç”»é¢ã‚’æ‹¡å¤§ã—ã¦æã„ã¦ã¿ã‚ˆã†!</dd>
          </dl>
        </section>
      </main>
      <footer>
				<small>(C) Nyao </small>
			</footer>
     </div>



   <script>
      //JavaScriptã®ã‚¨ãƒªã‚¢
      const save = document.getElementById("save");
      const ok = document.getElementById("ok"); // ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ãƒœã‚¿ãƒ³ã‚’ä¿å­˜ãƒœã‚¿ãƒ³ã«
      const input1 = document.getElementById("input1"); //å¤ªã•
      const input2 = document.getElementById("input2"); //è‰²
      const mode = document.getElementById("mode"); //æç”»ãƒ¢ãƒ¼ãƒ‰
      let modeN = "1";
      const canvas1 = document.getElementById("canvas1");
      const canvas2 = document.getElementById("canvas2"); //ã²ã¨ã¤å‰ã®çµµ
      const canvas3 = document.getElementById("canvas3"); //æœ€å¾Œã®ã¨ã‚Šã¾ã¨ã‚ç”¨
      const ctx1 = canvas1.getContext("2d",{willReadFrequently:true}); // willReadFrequently:getImageData()ã®ãƒ¡ãƒ¢ãƒªç¯€ç´„
      const ctx2 = canvas2.getContext("2d",{willReadFrequently:true});
      const ctx3 = canvas3.getContext("2d",{willReadFrequently:true});
      const can = document.getElementById("canvases"); //ã‚­ãƒ£ãƒ³ãƒã‚¹å…¨ä½“

      //1.å¤‰æ•°ã®è¨­å®šã¨åˆæœŸåŒ–
      const pen = {x:0, y:0};
      let tms = ""
      let lwidth = 10; // ç·šã®å¤ªã•
      let lcolor = "blue"
      let v1 = 100;  // ãƒŸãƒªç§’ã®åˆæœŸå€¤
      let flg = 0; // mousedownã—ãŸã‚‰1, upã®æ™‚ã¯0
      // let viewFlg = 0;
      const tms1 = ["ãŠã©ã‚‹", "ã‹ã‚ã„ã„", "ã¸ã‚“ã¦ã“ãª", "ã•ã‹ã•ã¾ãª"];
      const tms2 = ["ã®ã‚Šã‚‚ã®", "ãƒ­ãƒœãƒƒãƒˆ", "ã„ãã‚‚ã®", "ãŠã†ã¡"];
      // const s = 80; // canvas3ã®èª¤å·®

      //ã‚­ãƒ£ãƒ³ãƒã‚¹ã®ã‚µã‚¤ã‚ºèª¿æ•´
      let width = 600;
      let height = 500;
      if (width > screen.width){
        changeSize();
      }
      let height3 = height + 100;
      can.style.width = width + "px";
      can.style.height = height3 + "px";
      canvas1.width = width;
      canvas1.height = height;
      canvas2.width = width;
      canvas2.height = height;
      canvas3.width = width;
      canvas3.height = height3;

      //æœ€åˆã«è¡¨ç¤ºã•ã›ã‚‹ã‚‚ã®
      ctx3.fillStyle="blue";
      ctx3.fillRect(0,0,width,height3); 
      ctx3.fillStyle="white";
      ctx3.font="bold 20px 'Segoe Print', san-serif"; //ãƒ•ã‚©ãƒ³ãƒˆã‚’æŒ‡å®š
      ctx3.fillText("â†‘â†‘ãƒ†ãƒ¼ãƒã‚’é¸ã‚“ã§ã­!",10,40);

     //æç”»ã‚¹ã‚¿ã‚¤ãƒ«ã®è¨­å®š(å¾Œã§é¸æŠã§ãã‚‹ã‚ˆã†ã«ã™ã‚‹)
      ctx1.lineWidth = lwidth; //ç·šã®å¤ªã•ã‚’æŒ‡å®š
      ctx1.fillStyle = lcolor;
      ctx1.strokeStyle = lcolor; //ç·šã®è‰²ã‚’æŒ‡å®š
      ctx1.lineCap = "round"; //ç·šã®çµ‚ç‚¹ã¯ä¸¸ã
      ctx3.lineCap = "round"; //ç·šã®çµ‚ç‚¹ã¯ä¸¸ã

     //ãƒ†ãƒ¼ãƒé¸æŠ
     function select(){
      let r1 = Math.floor(Math.random()*tms1.length);
      let r2 = Math.floor(Math.random()*tms2.length);
      tms =  "ã€" + tms1[r1] + " "+ tms2[r2] + "ã€";
      reload()
     }

     //ç·šã®å¤ªã•å¤‰æ›´
     function change1(){
      lwidth = parseFloat(input1.value);
      ctx1.lineWidth = lwidth;
     }

     //ç·šã®è‰²å¤‰æ›´
     function change2(){
      lcolor = input2.value
      ctx1.fillStyle = lcolor;
      ctx1.strokeStyle = lcolor; //ç·šã®è‰²ã‚’æŒ‡å®š
     }

     //**æç”»ãƒ¢ãƒ¼ãƒ‰å¤‰æ›´
     function modeChange(){
      modeN=mode.value;
     }

     //æç”»é–‹å§‹
     function oekakiStart(){
        const hwidth=lwidth/2;
        if(modeN==="1"){
          flg = 1;
          ctx1.beginPath(); //ãƒ‘ã‚¹é–‹å§‹
          moveTo(pen.x, pen.y);
          ctx1.stroke();  
        }
        else if(modeN==="2"){
          ctx1.beginPath();
          ctx1.arc(pen.x, pen.y, lwidth/2, 0, 2*Math.PI,false);
          ctx1.closePath();
          ctx1.fill();
        }
        else if(modeN==="3"){
          ctx1.fillRect(pen.x-(lwidth/2), pen.y-(lwidth/2), lwidth, lwidth);
        }
        else if(modeN==="4"){
          ctx1.beginPath(); //ãƒ‘ã‚¹é–‹å§‹
          ctx1.moveTo(pen.x, pen.y); //é–‹å§‹ç‚¹ã®åº§æ¨™ã‚’æŒ‡å®š
          ctx1.lineTo(pen.x-hwidth, pen.y+lwidth); //é ‚ç‚¹ã®åº§æ¨™ã‚’æŒ‡å®š
          ctx1.lineTo(pen.x+hwidth, pen.y+lwidth); //é ‚ç‚¹ã®åº§æ¨™ã‚’æŒ‡å®š
          ctx1.closePath(); //ãƒ‘ã‚¹ã‚’é–‰ã˜ã‚‹
          ctx1.fill();  //å¡—ã‚‹
        }
        else if(modeN==="5"){
          ctx1.beginPath(); //ãƒ‘ã‚¹é–‹å§‹
          ctx1.moveTo(pen.x-hwidth, pen.y-hwidth); //é–‹å§‹ç‚¹ã®åº§æ¨™ã‚’æŒ‡å®š
          ctx1.lineTo(pen.x, pen.y);  //é ‚ç‚¹ã‚’è¿½åŠ 
          ctx1.lineTo(pen.x+hwidth, pen.y-hwidth); //çµ‚ç‚¹ã®åº§æ¨™ã‚’æŒ‡å®š
          ctx1.stroke();  //ç·šã‚’ã²ã  
        }
        ok.innerHTML = '<button class="btn" onclick="preview();">ã§ããŸ!</button>';
     }

     //x.æç”»é–‹å§‹
     canvas1.addEventListener("mousedown",function(){
        drow_add(ctx1, ctx2); //ctx1ã®çµµã‚’ctx2ã¸æ›¸ãè¾¼ã‚€
        oekakiStart();
     });

     //x.æç”»é–‹å§‹(ã‚¹ãƒãƒ›)
     canvas1.addEventListener("touchstart",function(e){
        drow_add(ctx1, ctx2); //ctx1ã®çµµã‚’ctx2ã¸æ›¸ãè¾¼ã‚€
        const rect = e.target.getBoundingClientRect();
        pen.x = e.clientX-rect.left;
        pen.y = e.clientY-rect.top;
        oekakiStart();
     },{passive:false});

    //x.åº§æ¨™è¿½åŠ 
    canvas1.addEventListener("mousemove",function(e){
      const rect = e.target.getBoundingClientRect();
      pen.x = e.clientX-rect.left;
      pen.y = e.clientY-rect.top;
      if(flg){
        ctx1.lineTo(pen.x, pen.y);
        ctx1.stroke();
      }
      // else if(tms!=""){
      //   markpre();
      // }
    });

    //x.åº§æ¨™è¿½åŠ (ã‚¹ãƒãƒ›ç”¨)
    canvas1.addEventListener("touchmove",
        function(e){
          e.preventDefault();
          const rect = e.target.getBoundingClientRect();
          pen.x=e.touches[0].clientX-rect.left;
          pen.y=e.touches[0].clientY-rect.top;
          if(flg){
            ctx1.lineTo(pen.x, pen.y);
            ctx1.stroke();}
        },{passive:false}
      );

    //x.æç”»çµ‚äº†
    canvas1.addEventListener("mouseup",function(){
      flg = 0;   
    });

    //x.æç”»çµ‚äº†2
    canvas1.addEventListener("mouseout",function(){
      flg = 0;
    });

    canvas1.addEventListener("touchend",function(){
      flg = 0;
    });


    //1ã¤å‰ã¾ã§ã®ä½œæ¥­ã‚’ä¿æŒ
    function drow_add(a, b){
      let img = a.getImageData(0, 0, width, height);
      b.putImageData(img, 0, 0);
    }

    // æœ€åˆã‹ã‚‰
    function reload(){
      ctx1.fillStyle="white";
      ctx1.fillRect(0,0,width,height); //èƒŒæ™¯ã¯ç™½
      ctx2.clearRect(0,0,width,height);
      reload3();
      ctx1.fillStyle=lcolor;
      // viewFlg = 1;
      ok.innerHTML="";
      save.innerHTML="";
    }

    function reload3(){
      ctx3.fillStyle="white";
      ctx3.fillRect(0,0,width,height3);
      ctx3.fillStyle="darkblue"; //å¡—è‰²ã‚’æŒ‡å®š
      ctx3.font="bold 20px 'Segoe Print', san-serif"; //ãƒ•ã‚©ãƒ³ãƒˆã‚’æŒ‡å®š
      ctx3.fillText("ãŠçµµæãã‚¹ã‚¿ãƒ¼ãƒˆ!",0,20);
      ctx3.fillStyle="black"; 
      ctx3.font="bold 16px 'Segoe Print', san-serif"; 
      ctx3.fillText(tms+"ã‚’æã„ã¦ã¿ã‚ˆã†!!",10,60); //æ–‡å­—(æ–‡å­—åˆ—,x,y)
    }

    // ãƒãƒ¼ã‚¯é¸æŠæ™‚ã®ç”»åƒã®è¡¨ç¤º
    // function markpre(){
    //   if(viewFlg){
    //     reload3();
    //     const hwidth=lwidth/2;
    //     ctx3.fillStyle=lcolor; 
    //     ctx3.lineWidth = lwidth;
    //     ctx3.strokeStyle = lcolor;
    //     if(modeN==="3"){
    //       ctx3.fillRect(pen.x-(lwidth/2), pen.y-(lwidth/2)+s, lwidth, lwidth);
    //     }
    //     else if(modeN==="4"){
    //       ctx3.beginPath(); //ãƒ‘ã‚¹é–‹å§‹
    //       ctx3.moveTo(pen.x, pen.y+s); //é–‹å§‹ç‚¹ã®åº§æ¨™ã‚’æŒ‡å®š
    //       ctx3.lineTo(pen.x-hwidth, pen.y+lwidth+s); //é ‚ç‚¹ã®åº§æ¨™ã‚’æŒ‡å®š
    //       ctx3.lineTo(pen.x+hwidth, pen.y+lwidth+s); //é ‚ç‚¹ã®åº§æ¨™ã‚’æŒ‡å®š
    //       ctx3.closePath(); //ãƒ‘ã‚¹ã‚’é–‰ã˜ã‚‹
    //       ctx3.fill();  //å¡—ã‚‹
    //     }
    //     else if(modeN==="5"){
    //       ctx3.beginPath(); //ãƒ‘ã‚¹é–‹å§‹
    //       ctx3.moveTo(pen.x-hwidth, pen.y-hwidth+s); //é–‹å§‹ç‚¹ã®åº§æ¨™ã‚’æŒ‡å®š
    //       ctx3.lineTo(pen.x, pen.y+s);  //é ‚ç‚¹ã‚’è¿½åŠ 
    //       ctx3.lineTo(pen.x+hwidth, pen.y-hwidth+s); //çµ‚ç‚¹ã®åº§æ¨™ã‚’æŒ‡å®š
    //       ctx3.stroke();  //ç·šã‚’ã²ã  
    //     }
    //     else{
    //       // ãƒšãƒ³ã¾ãŸã¯â—ã®æ™‚
    //       ctx3.beginPath();
    //       ctx3.arc(pen.x, pen.y+s, lwidth/2, 0, 2*Math.PI,false);
    //       ctx3.closePath();
    //       ctx3.fill();
    //     }
    //   }
    // }

    // ä¸€ã¤æˆ»ã™
    function back(){
      drow_add(ctx2, ctx1);      
    }

    function preview(){
      // viewFlg = 0;
      ctx3.fillStyle="white";
      ctx3.fillRect(0,0,width,height3);
      ctx3.fillStyle="black"; //å¡—è‰²ã‚’æŒ‡å®š
      ctx3.font="bold 20px 'Segoe Print', san-serif"; //ãƒ•ã‚©ãƒ³ãƒˆã‚’æŒ‡å®š
      ctx3.fillText(tms,10,50); //æ–‡å­—(æ–‡å­—åˆ—,x,y)
      let img = ctx1.getImageData(0, 0, width, height);
      ctx3.putImageData(img, 0, 80);
      save.innerHTML = '<button class="btn" onclick="download();">ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã™ã‚‹</button>';         
    }

    function download(){
        let link = document.createElement("a");
        link.href = canvas3.toDataURL("image/png");
        link.download = "img.png";
        link.click();
      }

    function changeSize(){
      width = screen.width - (screen.width*0.1);
      height = width - 100;
    }
   </script>
 </body>
</html>